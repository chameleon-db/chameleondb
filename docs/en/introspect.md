# Introspect
![Chameleon logo](../logo-200x150.png)

`chameleon introspect` inspects an existing database schema and generates a Chameleon schema file (`.cham`).

This command is intended for bootstrapping from legacy databases, validating table discovery, and generating a baseline schema for migration workflows.

---

## Command Syntax

```bash
chameleon introspect <database-url> [--output <file>] [--force]
```

Short forms:

```bash
chameleon introspect <database-url> -o schema.cham
chameleon introspect <database-url> -f
```

- `<database-url>` is required.
- Default output is `schema.cham`.
- `--force` bypasses overwrite safety checks.

---

## Connection String Variants

`introspect` supports direct URLs and environment-variable references.

### 1) Direct URL

```bash
chameleon introspect postgresql://user:pass@localhost:5432/mydb
```

### 2) Shell-style env reference (`$VAR`)

```bash
chameleon introspect $DATABASE_URL
```

### 3) Braced env reference (`${VAR}`)

```bash
chameleon introspect ${DATABASE_URL}
```

### 4) Explicit env reference (`env:VAR`)

```bash
chameleon introspect env:DATABASE_URL
```

If the referenced environment variable is missing or empty, the command fails with an explicit error.

---

## Paranoid Mode Verification

Before introspection starts, Chameleon checks Paranoid Mode from Schema Vault (if initialized).

### Behavior by mode

| Paranoid Mode | Introspect behavior |
|---|---|
| `readonly` | Blocked |
| `standard` | Allowed |
| `privileged` | Allowed |
| `emergency` | Allowed |

When mode is `readonly`, introspection aborts and instructs you to upgrade mode.

### Upgrade flow from `readonly`

Since mode upgrades require password authentication:

```bash
chameleon config auth set-password
chameleon config set mode=standard
chameleon introspect <database-url>
```

Notes:
- Upgrades require password (for example `readonly -> standard`).
- Downgrades do not require password.

---

## Output File Safety Checks

Without `--force`, introspect applies overwrite protections:

1. Validates that output path is not a directory.
2. Detects default template schemas generated by `chameleon init`.
3. Detects modified/working schemas and prompts backup-or-new-file flow.
4. Allows writing new files safely.

With `--force`, these checks are skipped.

---

## End-to-End Examples

### Baseline introspection from Railway-style env var

```bash
export DATABASE_URL="postgresql://user:pass@host:5432/dbname"
chameleon introspect $DATABASE_URL -o schema.introspected.cham
```

### Introspection with explicit env resolver syntax

```bash
chameleon introspect env:DATABASE_URL --output schema.cham
```

### Overwrite existing schema intentionally

```bash
chameleon introspect $DATABASE_URL --output schema.cham --force
```

---

## Operational Notes for Developers

- Introspection currently targets relational metadata discovery and schema generation.
- Generated schema should be reviewed manually (relations, naming, and conventions).
- Recommended follow-up:

```bash
chameleon validate
```

For migration-driven workflows, validate the generated schema and then continue with your standard migration cycle.